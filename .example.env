# ============================================================================
# GhostClass Environment Variables
# ============================================================================
# Copy this file to `.env` and fill in your actual values.
# NEVER commit the `.env` file to version control!
#
# Required variables are marked with ‚ö†Ô∏è
# Optional variables are marked with ‚ÑπÔ∏è
# ============================================================================

# ============================================================================
# SECRET MANAGEMENT STRATEGY
# ============================================================================
#
# GhostClass uses TWO-TIER secret management:
#
# üì¶ TIER 1: Build-time Secrets (GitHub Actions ‚Üí Baked into Docker Image)
#    - All NEXT_PUBLIC_* variables (safe - client-side only)
#    - SENTRY_AUTH_TOKEN (secure - BuildKit mount, not in layers)
#    - Build configuration (IMAGE_NAME, SOURCE_DATE_EPOCH, etc.)
#
# üîê TIER 2: Runtime Secrets (Coolify Environment Variables ‚Üí NEVER in image)
#    - ENCRYPTION_KEY
#    - CRON_SECRET
#    - SENTRY_HASH_SALT (lazy-loaded at runtime)
#    - SUPABASE_SERVICE_ROLE_KEY
#    - UPSTASH_REDIS_REST_URL
#    - UPSTASH_REDIS_REST_TOKEN
#    - TURNSTILE_SECRET_KEY
#    - Email provider credentials (SENDPULSE_*, BREVO_API_KEY)
#
# ‚ö†Ô∏è CRITICAL: Runtime secrets MUST be configured in Coolify, NOT in GitHub!
#
# ============================================================================

# ----------------------------------------------------------------------------
# PUBLIC APP CONFIGURATION
# ----------------------------------------------------------------------------
# These variables are exposed to the browser and used throughout the app.

# ‚ö†Ô∏è Application name displayed in UI and emails
NEXT_PUBLIC_APP_NAME=GhostClass

# ‚ö†Ô∏è App Version (displayed in health checks and footer)
NEXT_PUBLIC_APP_VERSION=1.5.6

# ‚ö†Ô∏è Your production domain (without https://)
# All URL-based variables are derived from this
NEXT_PUBLIC_APP_DOMAIN=ghostclass.devakesu.com

# ‚ÑπÔ∏è Author/maintainer information
NEXT_PUBLIC_AUTHOR_NAME=@deva.kesu
NEXT_PUBLIC_AUTHOR_URL=https://devakesu.com

# ‚ÑπÔ∏è GitHub repository URL
NEXT_PUBLIC_GITHUB_URL=https://github.com/devakesu/GhostClass

# ----------------------------------------------------------------------------
# DERIVED VARIABLES (AUTO-GENERATED FROM DOMAIN)
# ----------------------------------------------------------------------------
# These are automatically constructed in the pipeline and Dockerfile.
# You don't need to set them manually.
#
NEXT_PUBLIC_APP_URL=https://${NEXT_PUBLIC_APP_DOMAIN}
NEXT_PUBLIC_SITEMAP_URL=https://${NEXT_PUBLIC_APP_DOMAIN}/sitemap.xml
NEXT_PUBLIC_APP_EMAIL=@${NEXT_PUBLIC_APP_DOMAIN}
NEXT_PUBLIC_LEGAL_EMAIL=legal@${NEXT_PUBLIC_APP_DOMAIN}
NEXT_PUBLIC_SUPABASE_API_URL=${NEXT_PUBLIC_SUPABASE_URL}/functions/v1

# ----------------------------------------------------------------------------
# LEGAL & COMPLIANCE
# ----------------------------------------------------------------------------

# ‚ÑπÔ∏è Effective date for Terms of Service and Privacy Policy
NEXT_PUBLIC_LEGAL_EFFECTIVE_DATE=January 1, 2026

# ----------------------------------------------------------------------------
# SECURITY & ENCRYPTION
# ----------------------------------------------------------------------------
# Critical security variables - handle with extreme care!

# ‚ÑπÔ∏è FORCE_STRICT_CSP - Force production-like CSP behavior in development (optional)
# Valid values: "true", "1", or "yes" (case-insensitive)
# Default: false (relaxed CSP in development for easier debugging)
# 
# By default, GhostClass relaxes Content Security Policy (CSP) in development mode
# to make Next.js and tooling easier to work with (allows 'unsafe-inline', 'unsafe-eval').
# 
# Set this to "true" to test production-like strict CSP behavior locally:
#   - Enforces nonce-based script restrictions
#   - Disables 'unsafe-inline' and 'unsafe-eval' 
#   - Useful for testing CSP issues before deployment
#   - Helps reproduce production-only CSP violations in development
#
# For client-side access (browser environment variables), use:
# NEXT_PUBLIC_FORCE_STRICT_CSP=true
#
# Example usage:
#   FORCE_STRICT_CSP=true          # Server-side enforcement
#   NEXT_PUBLIC_FORCE_STRICT_CSP=1 # Client-side enforcement
FORCE_STRICT_CSP=
NEXT_PUBLIC_FORCE_STRICT_CSP=

# ‚ö†Ô∏è ENCRYPTION_KEY - Used for AES-256-GCM encryption of tokens and authentication credentials
# MUST be exactly 64 hexadecimal characters (32 bytes)
# Generate with: openssl rand -hex 32
# ‚ö†Ô∏è NEVER share this key! Changing it will invalidate all encrypted data.
# Used for:
#   - EzyGo token encryption (ezygo_token, ezygo_iv)
#   - Canonical password storage for multi-device authentication (auth_password, auth_password_iv)
ENCRYPTION_KEY=

# ‚ö†Ô∏è CRON_SECRET - Authorization token for automated sync jobs
# Generate with: openssl rand -base64 32
# Used in: /api/cron/sync endpoint
CRON_SECRET=

# ‚ÑπÔ∏è REQUEST_SIGNING_SECRET - Optional dedicated secret for request signature verification
# If not set, falls back to ENCRYPTION_KEY (which is acceptable)
# Generate with: openssl rand -hex 32
# Used for: API request signature validation (anti-tampering)
REQUEST_SIGNING_SECRET=

# ‚ÑπÔ∏è REQUEST_SIGNATURE_MAX_AGE - Maximum age for signed requests in seconds
# Default: 600 (10 minutes)
# Prevents replay attacks by rejecting old signatures
# Valid range: 60-3600 seconds (1 minute to 1 hour)
REQUEST_SIGNATURE_MAX_AGE=600

# ----------------------------------------------------------------------------
# EZYGO INTEGRATION
# ----------------------------------------------------------------------------
# EzyGo is the upstream attendance API (read-only, no credentials needed here)

# ‚ö†Ô∏è EzyGo API base URL - DO NOT CHANGE unless EzyGo migrates
NEXT_PUBLIC_BACKEND_URL=https://production.api.ezygo.app/api/v1/Xcr45_salt/

# ----------------------------------------------------------------------------
# UPSTASH REDIS (RATE LIMITING)
# ----------------------------------------------------------------------------
# Used for API rate limiting. Get your credentials from: https://upstash.com
# Free tier: 10,000 commands/day

# ‚ö†Ô∏è Upstash Redis REST API URL
# Example: https://your-redis-instance.upstash.io
UPSTASH_REDIS_REST_URL=

# ‚ö†Ô∏è Upstash Redis REST API Token (starts with "A...")
UPSTASH_REDIS_REST_TOKEN=

# ----------------------------------------------------------------------------
# RATE LIMITING
# ----------------------------------------------------------------------------
# Controls API rate limits using sliding window algorithm

# General endpoints (sync, contact, etc.)
RATE_LIMIT_REQUESTS=10       # Max requests per window
RATE_LIMIT_WINDOW=10         # Window in seconds

# Authentication endpoints (stricter)
AUTH_RATE_LIMIT_REQUESTS=5   # Max login attempts
AUTH_RATE_LIMIT_WINDOW=60    # Per 60 seconds (1 minute)

# ‚ÑπÔ∏è Authentication Lock TTL (Time To Live in seconds)
# Controls how long the authentication lock is held during the save-token process
# to prevent race conditions when multiple login attempts occur simultaneously.
# Default: 20 seconds | Min: 15 | Max: 60
# Increase if you experience timeout errors during slow authentication flows.
AUTH_LOCK_TTL=20

# ----------------------------------------------------------------------------
# SUPABASE (DATABASE & AUTHENTICATION)
# ----------------------------------------------------------------------------
# Get credentials from: https://supabase.com/dashboard
# Project Settings > API

# ‚ö†Ô∏è Your Supabase project URL
# Example: https://abcdefghijklmnop.supabase.co
NEXT_PUBLIC_SUPABASE_URL=

# ‚ö†Ô∏è Supabase Anonymous (public) key
# Safe to expose to browser - used for client-side auth
# Starts with: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
NEXT_PUBLIC_SUPABASE_ANON_KEY=

# ‚ö†Ô∏è Supabase Service Role key (ADMIN ACCESS - NEVER EXPOSE TO BROWSER!)
# Used for server-side operations that bypass Row Level Security (RLS)
# Only use in API routes and server components
# Starts with: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
SUPABASE_SERVICE_ROLE_KEY=

# ----------------------------------------------------------------------------
# CLOUDFLARE TURNSTILE (CAPTCHA)
# ----------------------------------------------------------------------------
# Get keys from: https://dash.cloudflare.com/?to=/:account/turnstile
# Used on: Contact form, login form (prevents bot abuse)

# ‚ö†Ô∏è WARNING: The keys below are TESTING KEYS that ALWAYS PASS validation!
# They are provided by Cloudflare for local development ONLY.
# 
# üö® YOU MUST REPLACE THESE WITH PRODUCTION KEYS BEFORE DEPLOYING! üö®
# 
# Production keys start with: 0x4AAAAAAA... (site key) and 0x4AAAAAAA... (secret)
# Test keys ALWAYS allow bots through - use ONLY in development!

# ‚ö†Ô∏è Turnstile Site Key (visible in browser)
# Testing key (always passes): 1x00000000000000000000AA
# Get production key from: https://dash.cloudflare.com/
NEXT_PUBLIC_TURNSTILE_SITE_KEY=1x00000000000000000000AA

# ‚ö†Ô∏è Turnstile Secret Key (server-side only - NEVER expose to browser!)
# Testing key (always passes): 1x0000000000000000000000000000000AA
TURNSTILE_SECRET_KEY=1x0000000000000000000000000000000AA

# ----------------------------------------------------------------------------
# EMAIL SERVICES (DUAL-PROVIDER FAILOVER)
# ----------------------------------------------------------------------------
# GhostClass uses two email providers for redundancy:
# - SendPulse (Primary)
# - Brevo (Fallback)
# At least ONE must be configured for contact forms and notifications to work.

# ‚ÑπÔ∏è SENDPULSE - Primary email provider
# Get credentials from: https://sendpulse.com/integrations/api
# Dashboard > Settings > API > Create new credentials

# SendPulse Client ID (looks like: abc123def456)
SENDPULSE_CLIENT_ID=

# SendPulse Client Secret (looks like: xyz789abc123)
SENDPULSE_CLIENT_SECRET=

# ‚ÑπÔ∏è BREVO (formerly Sendinblue) - Fallback email provider
# Get API key from: https://app.brevo.com/settings/keys/api
# Free tier: 300 emails/day

# Brevo API Key (starts with: xkeysib-)
BREVO_API_KEY=

# ----------------------------------------------------------------------------
# SENTRY (ERROR TRACKING & MONITORING)
# ----------------------------------------------------------------------------
# Get credentials from: https://sentry.io/settings/
# Used for: Crash reporting, performance monitoring, error alerts

# ‚ö†Ô∏è Sentry Organization slug (from your Sentry URL)
# Example: If your URL is sentry.io/organizations/devakesu/, use "devakesu"
SENTRY_ORG=devakesu

# ‚ö†Ô∏è Sentry Project slug
# Example: If your project is sentry.io/.../ghostclass/, use "ghostclass"
SENTRY_PROJECT=ghostclass

# ‚ö†Ô∏è Sentry Auth Token (for uploading source maps during build)
# Create at: https://sentry.io/settings/account/api/auth-tokens/
# Required scopes: project:read, project:releases, org:read
# Starts with: sntrys_...
SENTRY_AUTH_TOKEN=

# ‚ö†Ô∏è Sentry DSN (Data Source Name) - Public key for browser error reporting
# Found at: Sentry Project Settings > Client Keys (DSN)
# Example: https://abc123@o123456.ingest.sentry.io/7654321
# Safe to expose to browser
NEXT_PUBLIC_SENTRY_DSN=

# ‚ÑπÔ∏è Sentry Session Replay Sample Rate (optional, default: 0)
# Percentage of sessions to record for replay (0.0 to 1.0)
# Example: 0.1 = 10% of sessions recorded
# Warning: Increases bandwidth usage and Sentry quota consumption
# Recommended: 0.1 for production, 0 to disable
NEXT_PUBLIC_SENTRY_REPLAY_RATE=0

# ‚ö†Ô∏è Sentry Hash Salt - For redacting sensitive data in logs and error reports
# üîê RUNTIME SECRET - Lazy-loaded at first use (not during build)
# 
# Used for: Redacting sensitive data (emails, IDs) in Sentry error reports and logs
# Generate with: openssl rand -base64 32
# Required in production runtime, optional in development (uses fallback)
# Treat with the same security as database credentials
# 
# LAZY LOADING: Secret is validated at first use (runtime), not during Next.js build
# This allows builds to succeed without the secret while ensuring runtime security
SENTRY_HASH_SALT=

# ----------------------------------------------------------------------------
# GOOGLE ANALYTICS (OPTIONAL)
# ----------------------------------------------------------------------------
# Server-side tracking via GA4 Measurement Protocol (CSP-compatible)
# Get from: https://analytics.google.com/

# ‚ÑπÔ∏è Google Analytics 4 Measurement ID (optional, for usage analytics)
# Format: G-XXXXXXXXXX
# Get from: Admin ‚Üí Data Streams ‚Üí Select your stream ‚Üí Measurement ID
# Example: G-ABC123XYZ
NEXT_PUBLIC_GA_ID=

# ‚ö†Ô∏è GA4 API Secret (REQUIRED if using GA, server-side only)
# Format: Random alphanumeric string (never exposed to browser)
# Get from: Admin ‚Üí Data Streams ‚Üí Select stream ‚Üí Measurement Protocol API secrets ‚Üí Create
# Used for server-side event tracking via Measurement Protocol
# Example: abc123DEF456ghi789JKL
GA_API_SECRET=

# ----------------------------------------------------------------------------
# USER SETTINGS (OPTIONAL)
# ----------------------------------------------------------------------------
# Configure default values for user settings and behavior

# ‚ÑπÔ∏è Minimum attendance target percentage (optional, default: 75)
# Valid range: 1-100
# Controls the minimum value users can set for their attendance target
# Adjust based on your institution's minimum attendance requirements
# Example: 60 for institutions requiring 60% minimum attendance
# This is a public variable (NEXT_PUBLIC_*) and will be available in the browser
NEXT_PUBLIC_ATTENDANCE_TARGET_MIN=75

# ============================================================================
# GITHUB SECRETS CONFIGURATION (FOR CI/CD PIPELINE)
# ============================================================================
# These variables are ONLY needed in your GitHub repository secrets for the
# CI/CD pipeline to work. They are NOT used in local development.
#
# Required GitHub Secrets:
# ------------------------
# Build Configuration:
IMAGE_NAME=ghostclass
SOURCE_DATE_EPOCH=1767225600
APP_COMMIT_SHA=<auto-generated-by-github-actions>
#
# Release Automation:
#   APP_ID=<github-app-id>
#   APP_PRIVATE_KEY=<github-app-private-key-pem>
#   - GitHub App for auto-version-and-tag workflow
#   - Required to create PRs and push tags that trigger the Release workflow
#   - GITHUB_TOKEN cannot trigger other workflows; a GitHub App is necessary
#   - Create at: Settings ‚Üí Developer settings ‚Üí GitHub Apps ‚Üí New GitHub App
#   - Required permissions: Contents (Read/Write), Pull Requests (Read/Write)
#   - Generate private key and save the .pem file
#   - Add as repository secrets at: Settings > Secrets and variables > Actions
#   GPG_PRIVATE_KEY=<gpg-private-key>
#   GPG_PASSPHRASE=<gpg-passphrase-or-single-space-or-omit>
#   - GPG key for signing commits and tags
#   - Required for commit signature verification
#   - If your key uses %no-protection, omit the GPG_PASSPHRASE secret entirely.
#   - Otherwise, set GPG_PASSPHRASE to the real passphrase or a benign placeholder
#     value (e.g., a single space) since GitHub Actions secrets cannot be empty.
#   - Generate with: gpg --batch --gen-key
#   - Export with: gpg --armor --export-secret-keys KEY_ID
#   - Add as repository secrets at: Settings > Secrets and variables > Actions
#
# Sentry (same as above):
#   SENTRY_ORG=devakesu
#   SENTRY_PROJECT=ghostclass
#   SENTRY_AUTH_TOKEN=<your-token>
#
# App Configuration (same as above):
#   NEXT_PUBLIC_APP_NAME=GhostClass
#   NEXT_PUBLIC_APP_DOMAIN=ghostclass.devakesu.com
#   NEXT_PUBLIC_AUTHOR_NAME=@deva.kesu
#   NEXT_PUBLIC_AUTHOR_URL=https://devakesu.com
#   NEXT_PUBLIC_APP_EMAIL=@ghostclass.devakesu.com
#   NEXT_PUBLIC_LEGAL_EFFECTIVE_DATE=January 1, 2026
#
# Backend & Services (same as above):
#   NEXT_PUBLIC_BACKEND_URL=https://production.api.ezygo.app/api/v1/Xcr45_salt/
#   NEXT_PUBLIC_SUPABASE_URL=<your-supabase-url>
#   NEXT_PUBLIC_SUPABASE_ANON_KEY=<your-anon-key>
#   NEXT_PUBLIC_GITHUB_URL=https://github.com/devakesu/GhostClass
#   NEXT_PUBLIC_SENTRY_DSN=<your-dsn>
#   NEXT_PUBLIC_TURNSTILE_SITE_KEY=<your-site-key>
#   NEXT_PUBLIC_GA_ID=<your-ga-id>
#
# Coolify Deployment
COOLIFY_BASE_URL=<your-coolify-url>
COOLIFY_APP_ID=<your-app-id>
COOLIFY_API_TOKEN=<your-api-token>
#
# Derived automatically in pipeline:
#   NEXT_PUBLIC_APP_URL (from NEXT_PUBLIC_APP_DOMAIN)
#   NEXT_PUBLIC_SITEMAP_URL (from NEXT_PUBLIC_APP_DOMAIN)
#   NEXT_PUBLIC_LEGAL_EMAIL (from NEXT_PUBLIC_APP_DOMAIN)
#
# ============================================================================

# ============================================================================
# QUICK START GUIDE
# ============================================================================
# 1. Copy this file:
#    cp .example.env .env
#
# 2. Generate security keys:
#    openssl rand -hex 32  # For ENCRYPTION_KEY (64 chars)
#    openssl rand -base64 32  # For CRON_SECRET
#
# 3. Set up Supabase:
#    - Create project at https://supabase.com
#    - Run: npx supabase link --project-ref <your-project-id>
#    - Run: npx supabase db push
#    - Copy API keys from Project Settings > API
#
# 4. Set up Upstash Redis:
#    - Create database at https://upstash.com
#    - Copy REST URL and Token
#
# 5. Set up Cloudflare Turnstile:
#    - Get production keys from https://dash.cloudflare.com/
#    - Replace test keys with real ones
#
# 6. (Optional) Set up email providers:
#    - Configure at least one: SendPulse OR Brevo
#    - Both can be used for automatic failover
#
# 7. (Optional) Set up monitoring:
#    - Sentry for error tracking
#    - Google Analytics for usage stats
#
# 8. Set up GitHub Secrets (for CI/CD):
#    - Go to your repository > Settings > Secrets and variables > Actions
#    - Add all the secrets listed in the "GITHUB SECRETS CONFIGURATION" section
#    - IMPORTANT: GitHub App credentials for auto-tag-release:
#      * Create GitHub App at: Settings ‚Üí Developer settings ‚Üí GitHub Apps
#      * Required permissions: Contents (Read/Write), Pull Requests (Read/Write)
#      * Add as repository secrets:
#        - APP_ID: Your GitHub App's ID
#        - APP_PRIVATE_KEY: Full contents of the .pem private key file
#    - IMPORTANT: GPG key for commit signing:
#      * Generate with: gpg --batch --gen-key
#      * Add as repository secrets:
#        - GPG_PRIVATE_KEY: Full GPG private key including headers
#        - GPG_PASSPHRASE: For %no-protection keys, omit this secret entirely, or use a benign placeholder (e.g., single space) if required
#
# ============================================================================
# SECURITY CHECKLIST
# ============================================================================
# ‚úÖ .env file is in .gitignore
# ‚úÖ ENCRYPTION_KEY is 64 hex characters
# ‚úÖ Turnstile keys are PRODUCTION keys (not 1x00...)
# ‚úÖ SUPABASE_SERVICE_ROLE_KEY is never exposed to browser
# ‚úÖ All secrets are stored in environment variables (not hardcoded)
# ‚úÖ Production secrets are different from development secrets
# ‚úÖ GitHub Secrets are configured for CI/CD pipeline
# ‚úÖ RELEASE_TOKEN (PAT) is configured for auto-version workflow
# ‚úÖ Derived variables (URLs, emails) are constructed automatically
# ============================================================================
